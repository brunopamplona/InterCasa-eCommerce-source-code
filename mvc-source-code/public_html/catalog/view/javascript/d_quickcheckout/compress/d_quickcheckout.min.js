function preloaderStart(){$(".preloader").delay(500).fadeIn(300)}function preloaderStop(){$(".preloader").stop(!0,!0).fadeOut(300)}function sformat(e,t){var n=e;return n=n.replace(/\{firstname\}/g,"<strong>"+t.firstname),n=n.replace(/\{lastname\}/g,t.lastname+"</strong>"),n=n.replace(/\{company\}/g,t.company),n=n.replace(/\{address_1\}/g,t.address_1),n=n.replace(/\{address_2\}/g,t.address_2),n=n.replace(/\{city\}/g,t.city),n=n.replace(/\{zone\}/g,t.zone),n=n.replace(/\{country\}/g,t.country),n=n.replace(/\{postcode\}/g,t.postcode),n=n.replace(/\{zone_code\}/g,t.zone_code),n=n.replace(/^\s*\n/gm,""),n=n.replace(/^\s+|\s+$/g,"")}!function(e,t){"undefined"!=typeof exports?module.exports=t(require("jquery"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],t):t(e.$,e._,e.Backbone)}(this,function(e,t,n){"use strict";var i,a=[];return n.NestedModel=n.Model.extend({get:function(e){return n.NestedModel.walkThenGet(this.attributes,e)},previous:function(e){return n.NestedModel.walkThenGet(this._previousAttributes,e)},has:function(e){var n=this.get(e);return!(null===n||t.isUndefined(n))},set:function(e,a,o){var s,r,c,d=n.NestedModel.deepClone(this.attributes);if(t.isString(e)?s=n.NestedModel.attrPath(e):t.isArray(e)&&(s=e),s)o=o||{},this._setAttr(d,s,a,o);else{o=a||{};var h=e;for(var u in h)h.hasOwnProperty(u)&&this._setAttr(d,n.NestedModel.attrPath(u),o.unset?void 0:h[u],o)}return i=n.NestedModel.__super__.changedAttributes.call(this),o.unset&&s&&1===s.length?(r={},r[e]=void 0,i=t.omit(i,t.keys(r)),c=n.NestedModel.__super__.set.call(this,r,o)):(r=d,o.unset&&s?(o=t.extend({},o),delete o.unset):o.unset&&t.isObject(e)&&(r=e),i=t.omit(i,t.keys(r)),c=n.NestedModel.__super__.set.call(this,r,o)),c?(this._runDelayedTriggers(),this):(this.changed={},i={},!1)},unset:function(e,n){return this.set(e,void 0,t.extend({},n,{unset:!0}))},clear:function(e){i={},e=e||{};var n=t.clone(this.attributes);if(!e.silent&&this.validate&&!this.validate(n,e))return!1;var a=this.changed={},o=this,s=function(e,n,i){t.each(e,function(r,c){var d=n;t.isArray(e)?d+="["+c+"]":n?d+="."+c:d=c,r=e[c],t.isObject(r)&&s(r,d,i),i.silent||o._delayedChange(d,null,i),a[d]=null})};return s(this.attributes,"",e),this.attributes={},e.silent||this._delayedTrigger("change"),this._runDelayedTriggers(),this},add:function(e,n,i){var a=this.get(e);if(!t.isArray(a))throw new Error("current value is not an array");return this.set(e+"["+a.length+"]",n,i)},remove:function(e,i){i=i||{};var a=n.NestedModel.attrPath(e),o=t.initial(a),s=this.get(o),r=t.last(a);if(!t.isArray(s))throw new Error("remove() must be called on a nested array");var c=!i.silent&&s.length>=r+1,d=s[r];if(s.splice(r,1),i.silent=!0,this.set(o,s,i),c){e=n.NestedModel.createAttrStr(o),this.trigger("remove:"+e,this,d);for(var h=o.length;h>=1;h--)e=n.NestedModel.createAttrStr(t.first(o,h)),this.trigger("change:"+e,this,d);this.trigger("change",this,d)}return this},changedAttributes:function(e){var a=n.NestedModel.__super__.changedAttributes.call(this,e);return t.isObject(a)?t.extend({},i,a):!1},toJSON:function(){return n.NestedModel.deepClone(this.attributes)},_delayedTrigger:function(){a.push(arguments)},_delayedChange:function(e,t,n){this._delayedTrigger("change:"+e,this,t,n),this.changed||(this.changed={}),this.changed[e]=t},_runDelayedTriggers:function(){for(;a.length>0;)this.trigger.apply(this,a.shift())},_setAttr:function(e,i,a,o){o=o||{};var s=i.length,r=this;n.NestedModel.walkPath(e,i,function(e,c,d){var h=t.last(c),u=n.NestedModel.createAttrStr(c),p=!t.isEqual(e[h],a);if(c.length===s){if(o.unset){if(delete e[h],t.isArray(e)){var l=n.NestedModel.createAttrStr(t.initial(i));r._delayedTrigger("remove:"+l,r,e[h])}}else e[h]=a;if(!o.silent&&t.isObject(a)&&p){var m=[],g=function(e,n){if(!(t.indexOf(m,e)>-1)){m.push(e);var i,a;for(var s in e)e.hasOwnProperty(s)&&(i=n+"."+s,a=e[s],t.isEqual(r.get(i),a)||r._delayedChange(i,a,o),t.isObject(a)&&g(a,i))}};g(a,u)}}else e[h]||(t.isNumber(d)?e[h]=[]:e[h]={});o.silent||(c.length>1&&p&&r._delayedChange(u,e[h],o),t.isArray(e[h])&&r._delayedTrigger("add:"+u,r,e[h]))})}},{attrPath:function(e){var n;return t.isString(e)?(n=""===e?[""]:e.match(/[^\.\[\]]+/g),n=t.map(n,function(e){return e.match(/^\d+$/)?parseInt(e,10):e})):n=e,n},createAttrStr:function(e){var n=e[0];return t.each(t.rest(e),function(e){n+=t.isNumber(e)?"["+e+"]":"."+e}),n},deepClone:function(t){return e.extend(!0,{},t)},walkPath:function(e,t,n,i){for(var a,o=e,s=0;s<t.length&&(n.call(i||this,o,t.slice(0,s+1),t[s+1]),a=t[s],o=o[a],o);s++);},walkThenGet:function(e,i){var a,o=n.NestedModel.attrPath(i);return n.NestedModel.walkPath(e,o,function(e,n){var i=t.last(n);n.length===o.length&&(a=e[i])}),a}}),n}),window.console||(window.console={}),window.console.log||(window.console.log=function(){});var qc=qc||{},focused=window;qc.event=_.extend({},Backbone.Events),qc.statistic=qc.statistic||{},$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},qc.Model=Backbone.NestedModel.extend({defaults:"",initialize:function(){console.log("Engine Model start")},isJson:function(e){try{JSON.parse(e)}catch(t){return!1}return!0},updateForm:function(e){preloaderStop(),parseInt(config.general.debug)&&console.log(e),qc.event.trigger("update",e),e.redirect&&(window.location=e.redirect),e.account&&qc.event.trigger("changeAccount",e.account),e.login_error&&qc.login.set("error",e.login_error),e.error&&alert(e.error)}}),qc.View=Backbone.View.extend({defaults:"",initialize:function(){console.log("Engine View start")},events:{"focus input":"updateFocus"},changeAccount:function(e){this.model.get("account")!==e&&(this.model.changeAccount(e),this.render())},isJson:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}}),qc.Login=qc.Model.extend({defaults:"",initialize:function(){this.set("config",config.account[this.get("account")].login)},changeAccount:function(e){this.set("account",e)},loginAccount:function(e){this.set(e);var t=this;$.post("index.php?route=d_quickcheckout/login/loginAccount",e,function(e){parseInt(config.general.login_refresh)?window.location.reload():t.updateForm(e)},"json").error()},updateAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].login);var t=this.toJSON(),n=this;$.post("index.php?route=d_quickcheckout/login/updateAccount",{account:t.account},function(e){n.updateForm(e)},"json").error()}}),qc.LoginView=qc.View.extend({initialize:function(e){Backbone.View.prototype.initialize.call(this),this.template=e.template,qc.event.bind("changeAccount",this.changeAccount,this),this.model.on("change",this.render,this),this.render()},events:{"change input[name=account]":"updateAccount","click button#button_login":"loginAccount"},template:"",render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),$("body").on("click",function(){$("#login_button_popup").removeClass("active")})},changeAccount:function(e){this.model.get("account")!==e&&(this.model.changeAccount(e),this.render())},updateAccount:function(e){this.model.updateAccount(e.currentTarget.value),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click",e.currentTarget.name),preloaderStart()},loginAccount:function(e){$("#login_model").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove();var t=$("#login_form").serializeObject();return this.model.loginAccount(t),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click","login"),preloaderStart(),!1}}),qc.FieldView=qc.View.extend({initialize:function(e){this.template=e.template},events:{"change input[type=text].not-required":"updateField","change input[type=text].required":"validateField","change input[type=email].not-required":"updateField","change input[type=email].required":"validateField","change input[type=password].not-required":"updateField","change input[type=password].required":"validateField","change input[type=datetime].not-required":"updateField","change input[type=datetime].required":"validateField","change input[type=date].not-required":"updateField","change input[type=date].required":"validateField","change input[type=time].not-required":"updateField","change input[type=time].required":"validateField","change input[type=radio].not-required":"updateField","change input[type=radio].required":"validateField","change input[type=checkbox].not-required":"updateCheckbox","change input[type=checkbox].required":"validateCheckbox","change textarea":"validateField","change select":"validateField"},template:"",render:function(){this.setValidate(),$(this.el).html(this.template({model:this.model.toJSON()})),$(".sort-item").tsort({attr:"data-sort"}),$(".qc-mask").each(function(){$(this).mask($(this).attr("qc-mask"))})},setValidate:function(){$(this.el).validate({submitHandler:function(e){},errorPlacement:function(e,t){e.appendTo(t.closest('div[class^="col-"]'))},highlight:function(e,t,n){$(e.form).find("#"+e.id+"_input").addClass("has-error")},unhighlight:function(e,t,n){$(e.form).find("#"+e.id+"_input").removeClass("has-error")},errorClass:"text-danger",errorElement:"div"})},validateField:function(e){$(e.currentTarget).valid()?this.updateField(e):(parseInt(config.general.analytics_event)&&ga("send","event",config.name,"error",e.currentTarget.name+"."+e.currentTarget.value),preloaderStop())},updateField:function(e){this.model.updateField(e.currentTarget.name,e.currentTarget.value),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update",e.currentTarget.name),preloaderStart()},validateCheckbox:function(e){$(e.currentTarget).valid()?this.updateCheckbox(e):(parseInt(config.general.analytics_event)&&ga("send","event",config.name,"error",e.currentTarget.name+"."+e.currentTarget.value),preloaderStop())},updateCheckbox:function(e){$(e.currentTarget).is(":checked")?this.model.updateField(e.currentTarget.name,1):this.model.updateField(e.currentTarget.name,0),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update",e.currentTarget.name),preloaderStart()}}),qc.PaymentAddress=qc.Model.extend({defaults:{payment_address:"",config:"",account:"",addresses:""},initialize:function(){this.set("config",config.account[this.get("account")].payment_address)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].payment_address)},changeAddress:function(e){this.set("payment_address.address_id",e),"new"!=e&&this.set("payment_address.shipping_address",0);var t=this.toJSON(),n=this;$.post("index.php?route=d_quickcheckout/payment_address/update",{payment_address:t.payment_address},function(e){n.updateForm(e)},"json").error()},updateField:function(e,t){this.set(e,t);var n=this,i=this.toJSON();$.post("index.php?route=d_quickcheckout/payment_address/update",{payment_address:i.payment_address},function(e){n.updateForm(e)},"json").error()}}),qc.PaymentAddressView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),this.render()},events:{"change input[type=radio].payment-address":"changeAddress","change select.country_id":"changeCountry"},template:"",fields:"",changeAccount:function(e){this.model.get("account")!==e&&(this.model.changeAccount(e),this.render())},changeAddress:function(e){this.model.changeAddress(e.currentTarget.value),this.render(),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","payment_address.changeAddress"),preloaderStart()},changeCountry:function(e){this.model.set("shipping_address.zone_id",0),this.setZone(e.currentTarget.value),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","payment_address.changeCountry"),preloaderStart()},setZone:function(e){var t=this;$.post("index.php?route=d_quickcheckout/field/getZone",{country_id:e},function(e){t.model.set("config.fields.zone_id.options",e),t.render()},"json")},update:function(e){e.payment_address&&this.model.set("payment_address",e.payment_address),"undefined"!=typeof e.shipping_required&&(this.model.set("shipping_required",e.shipping_required),this.render()),e.addresses&&(this.model.set("addresses",e.addresses),this.render()),e.account&&e.account!==this.model.get("account")&&(this.changeAccount(e.account),this.setZone(this.model.get("payment_address.country_id"))),e.payment_address_refresh&&this.render()},shipping_required:function(){this.model.get("shipping_required")?$("#payment_address_shipping_address_input").show():$("#payment_address_shipping_address_input").hide()},render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),this.fields=$.extend(!0,{},new qc.FieldView({el:$("#payment_address_form"),model:this.model,template:_.template($("#field_template").html())})),this.fields.render(),this.shipping_required()}}),qc.ShippingAddress=qc.Model.extend({defaults:{shipping_address:"",config:"",account:"",addresses:"",show_shipping_address:""},initialize:function(){this.set("config",config.account[this.get("account")].shipping_address)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].shipping_address)},changeAddress:function(e){this.set("shipping_address.address_id",e);var t=this.toJSON(),n=this;$.post("index.php?route=d_quickcheckout/shipping_address/update",{shipping_address:t.shipping_address},function(e){n.updateForm(e)},"json").error()},updateField:function(e,t){this.set(e,t);var n=this.toJSON(),i=this;$.post("index.php?route=d_quickcheckout/shipping_address/update",{shipping_address:n.shipping_address},function(e){i.updateForm(e)},"json").error()}}),qc.ShippingAddressView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),this.render()},events:{"change input[type=radio].shipping-address":"changeAddress","change select.country_id":"changeCountry"},template:"",fields:"",changeAccount:function(e){this.model.get("account")!==e&&(this.model.changeAccount(e),this.render())},changeAddress:function(e){this.model.changeAddress(e.currentTarget.value),this.render(),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","shipping_address.changeAddress"),preloaderStart()},changeCountry:function(e){this.model.set("shipping_address.zone_id",0),this.setZone(e.currentTarget.value),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","shipping_address.changeCountry"),preloaderStart()},setZone:function(e){var t=this;$.post("index.php?route=d_quickcheckout/field/getZone",{country_id:e},function(e){t.model.set("config.fields.zone_id.options",e),t.render()},"json")},update:function(e){e.shipping_address&&this.model.set("shipping_address",e.shipping_address),"undefined"!=typeof e.show_shipping_address&&e.show_shipping_address!==this.model.get("show_shipping_address")&&(this.model.set("show_shipping_address",e.show_shipping_address),this.render()),e.addresses&&(this.model.set("addresses",e.addresses),this.render()),"undefined"!=typeof e.account&&e.account!==this.model.get("account")&&(this.changeAccount(e.account),this.setZone(this.model.get("shipping_address.country_id"))),e.shipping_address_refresh&&this.render()},render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),this.fields=$.extend(!0,{},new qc.FieldView({el:$("#shipping_address_form"),model:this.model,template:_.template($("#field_template").html())})),this.fields.render()}}),qc.ShippingMethod=qc.Model.extend({defaults:"",initialize:function(){this.set("config",config.account[this.get("account")].shipping_method)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].shipping_method)},update:function(e){var t=this;$.post("index.php?route=d_quickcheckout/shipping_method/update",e,function(e){t.updateForm(e)},"json").error()}}),qc.ShippingMethodView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),this.model.on("change",this.render,this),this.render()},events:{"change input[type=radio]":"updateShippingMethod","change select":"updateShippingMethod"},template:"",updateShippingMethod:function(e){this.model.update($("#shipping_method_form").serializeArray()),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","shipping_method."+e.currentTarget.value),preloaderStart()},render:function(){$(this.el).html(this.template({model:this.model.toJSON()}))},update:function(e){e.shipping_method&&this.model.set("shipping_method",e.shipping_method),"undefined"!=typeof e.show_shipping_method&&this.model.set("show_shipping_method",e.show_shipping_method),e.shipping_methods&&this.model.set("shipping_methods",e.shipping_methods),e.account&&e.account!==this.model.get("account")&&this.changeAccount(e.account),e.shipping_method_error&&this.model.set("error",e.shipping_method_error)}}),qc.PaymentMethod=qc.Model.extend({defaults:"",initialize:function(){this.set("config",config.account[this.get("account")].payment_method)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].payment_method)},update:function(e){var t=this;$.post("index.php?route=d_quickcheckout/payment_method/update",e,function(e){t.updateForm(e)},"json").error()}}),qc.PaymentMethodView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),this.model.on("change",this.render,this),this.render()},events:{"change input[type=radio]":"updatePaymentMethod","change select":"updatePaymentMethod"},template:"",updatePaymentMethod:function(e){this.model.update($("#payment_method_form").serializeArray()),"radio"==this.model.get("config.input_style")&&($(".payment-method-terms").hide(),$(".payment-method-terms."+e.currentTarget.value).show()),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","payment_method."+e.currentTarget.value),preloaderStart()},update:function(e){e.payment_method&&this.model.set("payment_method",e.payment_method),e.payment_methods&&this.model.set("payment_methods",e.payment_methods),e.account&&e.account!==this.model.get("account")&&this.changeAccount(e.account)},render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),$("img").error(function(){$(this).hide()})}}),qc.Cart=qc.Model.extend({defaults:"",initialize:function(){this.set("config",config.account[this.get("account")].cart)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].cart)},updateQuantity:function(e,t){this.set(e,t);var n=this;$.post("index.php?route=d_quickcheckout/cart/update",this.toJSON(),function(e){n.updateForm(e)},"json").error()},updateVoucher:function(e){this.set("voucher",e);var t=this;$.post("index.php?route=d_quickcheckout/cart/updateVoucher",this.toJSON(),function(e){t.updateForm(e)},"json").error()},updateCoupon:function(e){this.set("coupon",e);var t=this;$.post("index.php?route=d_quickcheckout/cart/updateCoupon",this.toJSON(),function(e){t.updateForm(e)},"json").error()},updateReward:function(e){this.set("reward",e);var t=this;$.post("index.php?route=d_quickcheckout/cart/updateReward",this.toJSON(),function(e){t.updateForm(e)},"json").error()}}),qc.CartView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),this.model.on("change",this.render,this),this.render()},events:{"click button.increase":"increaseQuantity","click button.decrease":"decreaseQuantity","click button.delete":"deleteQuantity","change input.qc-product-qantity":"updateQuantity","change input#voucher":"updateVoucher","change input#coupon":"updateCoupon","change input#reward":"updateReward"},template:"",decreaseQuantity:function(e){var t=$(e.currentTarget).parent().next();this.model.updateQuantity(t.attr("name"),parseInt(t.val())-1),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click","cart.quantity.decrease"),preloaderStart()},increaseQuantity:function(e){var t=$(e.currentTarget).parent().prev();this.model.updateQuantity(t.attr("name"),parseInt(t.val())+1),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click","cart.quantity.increase"),preloaderStart()},deleteQuantity:function(e){var t=$(e.currentTarget).parent().prev();this.model.updateQuantity(t.attr("name"),0),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click","cart.quantity.delete"),preloaderStart()},updateQuantity:function(e){var t=$(e.currentTarget);this.model.updateQuantity(t.attr("name"),parseInt(t.val())),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","cart.quantity"),preloaderStart()},updateHeaderCart:function(e){setTimeout(function(){$("#cart > button").html('<span id="cart-total"><i class="fa fa-shopping-cart"></i> '+e+"</span>")},100),$("#cart > ul").load("index.php?route=common/cart/info ul li")},updateVoucher:function(e){this.model.updateVoucher($(e.currentTarget).val()),this.model.set("errors",[]),this.model.set("successes",[]),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","cart.voucher"),preloaderStart()},updateCoupon:function(e){this.model.updateCoupon($(e.currentTarget).val()),this.model.set("errors",[]),this.model.set("successes",[]),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","cart.coupon"),preloaderStart()},updateReward:function(e){this.model.updateReward($(e.currentTarget).val()),this.model.set("errors",[]),this.model.set("successes",[]),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"update","cart.reward"),preloaderStart()},update:function(e){e.cart&&this.model.set("cart",e.cart),e.products&&this.model.set("products",e.products),e.vouchers&&this.model.set("vouchers",e.vouchers),e.totals&&(this.model.set("totals",e.totals),this.updateHeaderCart(e.total)),e.cart_errors&&this.model.set("errors",e.cart_errors),"undefined"!=typeof e.cart_error&&this.model.set("error",e.cart_error),e.cart_successes&&this.model.set("successes",e.cart_successes),"undefined"!=typeof e.show_price&&this.model.set("show_price",e.show_price),e.account&&e.account!==this.model.get("account")&&this.changeAccount(e.account),e.cart_weight&&this.model.set("cart_weight",e.cart_weight)},render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),$(".qc-product-qantity").each(function(){$(this).mask($(this).attr("data-mask"),{placeholder:""})})}}),qc.Payment=qc.Model.extend({defaults:"",initialize:function(){this.set("config",config.account[this.get("account")].payment)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].payment)}}),qc.PaymentView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),qc.event.bind("paymentConfirm",this.paymentConfirm,this),this.model.on("change",this.render,this),this.render()},template:"",paymentConfirm:function(){if($(".alert").remove(),Number(this.model.get("payment_payment_popup")))$("#payment_modal").modal("show");else{var e=$(this.model.get("trigger"),this.$el).attr("href");""!=e&&void 0!=e?document.location.href=e:$(this.model.get("trigger"),this.$el).click()}},update:function(e){e.payment&&this.model.set("payment",e.payment),e.payment_payment_title&&this.model.set("payment_payment_title",e.payment_payment_title),"undefined"!=typeof e.payment_payment_popup&&this.model.set("payment_payment_popup",e.payment_payment_popup),e.account&&e.account!==this.model.get("account")&&this.changeAccount(e.account)},render:function(){$(this.el).html(this.template({model:this.model.toJSON()}))}}),qc.Confirm=qc.Model.extend({defaults:{confirm:"",config:"",account:""},initialize:function(){this.set("config",config.account[this.get("account")].confirm)},changeAccount:function(e){this.set("account",e),this.set("config",config.account[this.get("account")].confirm)},updateField:function(e,t){this.set(e,t);var n=this.toJSON(),i=this;$.post("index.php?route=d_quickcheckout/confirm/updateField",{confirm:n.confirm},function(e){i.updateForm(e)},"json").error()},update:function(){var e=this;$.post("index.php?route=d_quickcheckout/confirm/update",{},function(t){e.updateForm(t),qc.event.trigger("paymentConfirm"),e.recreateOrder()},"json").error()},recreateOrder:function(){$.post("index.php?route=d_quickcheckout/confirm/recreateOrder","",function(e){},"json").error()}}),qc.ConfirmView=qc.View.extend({initialize:function(e){this.template=e.template,qc.event.bind("update",this.update,this),qc.event.bind("changeAccount",this.changeAccount,this),this.render()},events:{"click button#qc_confirm_order":"confirm"},template:"",confirm:function(){preloaderStart();var e=!0;$("#d_quickcheckout form").each(function(){$(this).valid()||(e=!1,preloaderStop(),$("html,body").animate({scrollTop:$(".has-error").offset().top-60},"slow"))}),e&&this.model.update(),parseInt(config.general.analytics_event)&&ga("send","event",config.name,"click","confirm.confirm")},changeAccount:function(e){this.model.get("account")!==e&&(this.model.changeAccount(e),this.render())},update:function(e){e.confirm&&this.model.set("confirm",e.confirm),"undefined"!=typeof e.show_confirm&&(this.model.set("show_confirm",e.show_confirm),this.render()),"undefined"!=typeof e.payment_popup&&(this.model.set("payment_popup",e.payment_popup),this.render()),e.account&&e.account!==this.model.get("account")&&this.changeAccount(e.account)},render:function(){$(this.el).html(this.template({model:this.model.toJSON()})),this.fields=new qc.FieldView({el:$("#confirm_form"),model:this.model,template:_.template($("#field_template").html())}),this.fields.render()}}),"function"!=typeof $().modal&&!function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(e("body").addClass("modal-open"),this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1).focus(),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")}))},hide:function(t){t&&t.preventDefault(),t=e.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,e("body").removeClass("modal-open"),this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]===e.target||t.$element.has(e.target).length||t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){27==t.which&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&n;this.$backdrop=e('<div class="modal-backdrop '+n+'" />').appendTo(document.body),"static"!=this.options.backdrop&&this.$backdrop.click(e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(n){return this.each(function(){var i=e(this),a=i.data("modal"),o=e.extend({},e.fn.modal.defaults,i.data(),"object"==typeof n&&n);a||i.data("modal",a=new t(this,o)),"string"==typeof n?a[n]():o.show&&a.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),i=n.attr("href"),a=e(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=a.data("modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},a.data(),n.data());t.preventDefault(),a.modal(o).one("hide",function(){n.focus()})})})}(window.jQuery);